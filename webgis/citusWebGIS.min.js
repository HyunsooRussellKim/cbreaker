!function(){Proj4js.defs["EPSG:5187"]="+title=GRS_80_EAST_60 +proj=tmerc +lat_0=38 +lon_0=129 +k=1 +x_0=200000 +y_0=600000 +ellps=GRS80 +units=m +no_defs",Proj4js.defs["EPSG:5186"]="+title=GRS_80_EAST_60 +proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=600000 +ellps=GRS80 +units=m +no_defs",Proj4js.defs["EPSG:5179"]="+title=GRS_80_EAST_60 +proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +units=m +no_defs",Proj4js.defs["EPSG:5185"]="+title=GRS_80_EAST_60 +proj=tmerc +lat_0=38 +lon_0=127.5 +k=1 +x_0=200000 +y_0=600000 +ellps=GRS80 +units=m +no_defs",Proj4js.defs["EPSG:4737"]="+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs",Proj4js.defs["EPSG:4019"]="+proj=longlat +ellps=GRS80 +no_defs";var $WebGIS_proto={lon:128.52,lat:37.22,initialZoom:2,map:null,maxZoomLevel:13,visibleZoomLevel:6,epsg5187:null,epsg5186:null,epsg5179:null,epsg4326:null,epsg4019:null,epsg900913:null,epsgProj:null,epsgCode:"5186",epsgBase:null,styleContext:null,scalebar:null,navToolbar:null,editorToolbar:null,editor:null,layerSwitcher:null,history:null,webgisPrefix:null,shapePrefix:null,options:{url:{webgis:"http://localhost:8080/gis/citus/",shape:"http://localhost:8080/gis/"},basemap:{source:"localmap",layer:"YJ-gun",url:"https://gis.yeongwol.or.kr/geoserver"},toolbar:{element:null},editToolbar:{element:null},layerSwitcher:{element:null},handlers:{onSelect:function(){},onUnselect:function(){}},measures:{dist:function(){},area:function(){}},snaping:{layerName:"",tolerance:10}},LAYER:{WTL_PIPE_LM:{SA001:"WTL_PIPE_LM.SA001"},WTL_PIPE_PS:{SA900:"WTL_PIPE_PS.SA900"},WTL_MANH_PS:{SA100:"WTL_MANH_PS.SA100",SA991:"WTL_MANH_PS.SA991"},WTL_SPLY_LS:{SA002:"WTL_SPLY_LS.SA002"},WTL_STPI_PS:{SA003:"WTL_STPI_PS.SA003"},WTL_VALV_PS:{SA200:"WTL_VALV_PS.SA200",SA201:"WTL_VALV_PS.SA201",SA202:"WTL_VALV_PS.SA202",SA203:"WTL_VALV_PS.SA203",SA204:"WTL_VALV_PS.SA204",SA205:"WTL_VALV_PS.SA205"},WTL_FLOW_PS:{SA117:"WTL_FLOW_PS.SA117"},WTL_PRGA_PS:{SA121:"WTL_PRGA_PS.SA121"},WTL_FIRE_PS:{SA118:"WTL_FIRE_PS.SA118",SA119:"WTL_FIRE_PS.SA119"},WTL_LEAK_PS:{SA300:"WTL_LEAK_PS.SA300"},WTL_PRES_PS:{SA206:"WTL_PRES_PS.SA206"},WTL_PURI_AS:{SA113:"WTL_PURI_AS.SA113"},WTL_SERV_PS:{SA114:"WTL_SERV_PS.SA114"},WTL_HEAD_PS:{SA110:"WTL_HEAD_PS.SA110"},WTL_GAIN_PS:{SA112:"WTL_GAIN_PS.SA112"},WTL_META_PS:{SA122:"WTL_META_PS.SA122"},WTL_WTQT_PS:{SA123:"WTL_WTQT_PS.SA123"},WTL_RDCG_PS:{SA224:"WTL_RDCG_PS.SA224"},WTL_CTPN_PS:{SA992:"WTL_CTPN_PS.SA992"},WTL_BLOK_AS:{SA993:"WTL_BLOK_AS.SA993"},WTL_RSRV_PS:{SA120:"WTL_RSRV_PS.SA120"}},FEATURE:{"WTL_PIPE_LM.SA001":{type:"path"},"WTL_SPLY_LS.SA002":{type:"path"},"WTL_PIPE_PS.SA900":{type:"point"},"WTL_MANH_PS.SA100":{type:"point"},"WTL_MANH_PS.SA991":{type:"point"},"WTL_STPI_PS.SA003":{type:"point"},"WTL_VALV_PS.SA200":{type:"point"},"WTL_VALV_PS.SA201":{type:"point"},"WTL_VALV_PS.SA202":{type:"point"},"WTL_VALV_PS.SA203":{type:"point"},"WTL_VALV_PS.SA204":{type:"point"},"WTL_VALV_PS.SA205":{type:"point"},"WTL_FLOW_PS.SA117":{type:"point"},"WTL_PRGA_PS.SA121":{type:"point"},"WTL_FIRE_PS.SA118":{type:"point"},"WTL_FIRE_PS.SA119":{type:"point"},"WTL_LEAK_PS.SA300":{type:"point"},"WTL_PRES_PS.SA206":{type:"point"},"WTL_PURI_AS.SA113":{type:"polygon"},"WTL_SERV_PS.SA114":{type:"point"},"WTL_HEAD_PS.SA110":{type:"point"},"WTL_GAIN_PS.SA112":{type:"point"},"WTL_META_PS.SA122":{type:"point"},"WTL_WTQT_PS.SA123":{type:"point"},"WTL_RDCG_PS.SA224":{type:"point"},"WTL_CTPN_PS.SA992":{type:"point"},"WTL_BLOK_AS.SA993":{type:"polygon"},"WTL_RSRV_PS.SA120":{type:"point"}},STYLE:{"WTL_PIPE_LM.SA001":{"default":{label:"${label}",fillColor:"#ff0000",fillOpacity:.8,strokeColor:"#00f",strokeWidth:4,pointRadius:5},select:{strokeWidth:4,fillColor:"#00ff00",strokeColor:"#f70"},temporary:{fillColor:"#0000ff",fillOpacity:1,strokeWidth:5,pointRadius:10}},"WTL_PIPE_PS.SA900":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_MANH_PS.SA100":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_MANH_PS.SA991":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_SPLY_LS.SA002":{"default":{label:"${label}",strokeColor:"#00f",strokeWidth:1,pointRadius:5},select:{strokeWidth:3,fillColor:"#00ff00",strokeColor:"#f70"},temporary:{fillColor:"#0000ff",fillOpacity:1,strokeWidth:5,pointRadius:10}},"WTL_STPI_PS.SA003":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_VALV_PS.SA200":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_VALV_PS.SA201":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_VALV_PS.SA202":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_VALV_PS.SA203":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_VALV_PS.SA204":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_VALV_PS.SA205":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_FLOW_PS.SA117":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_PRGA_PS.SA121":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_FIRE_PS.SA118":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_FIRE_PS.SA119":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WML_LEAK_PS.SA300":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_PRES_PS.SA206":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_PURI_AS.SA113":{"default":{label:"${label}",fillColor:"#07f",fillOpacity:.8,strokeColor:"#037",strokeWidth:2,pointRadius:5},select:{fillColor:"#fc0",strokeColor:"#f70"},temporary:{fillColor:"#07f",fillOpacity:.8,strokeWidth:1,pointRadius:5}},"WTL_SERV_PS.SA114":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_HEAD_PS.SA110":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_GAIN_PS.SA112":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_META_PS.SA122":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_WTQT_PS.SA123":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_RDCG_PS.SA224":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_CTPN_PS.SA992":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}},"WTL_BLOK_AS.SA993":{"default":{label:"${label}",fillColor:"#07f",fillOpacity:.8,strokeColor:"#037",strokeWidth:2,pointRadius:5},select:{fillColor:"#fc0",strokeColor:"#f70"},temporary:{fillColor:"#07f",fillOpacity:.8,strokeWidth:1,pointRadius:5}},"WTL_RSRV_PS.SA120":{"default":{label:"${label}",externalGraphic:"${icon}",graphicWidth:15,graphicHeight:15,rotation:0},select:{graphicWidth:20,graphicHeight:20,rotation:0},temporary:{}}}},$WebGIS=function(element,options){citus.extend(this.options,options),this.load=function(e){return this.init(),"undefined"!=typeof e&&citus.task(function(){e.apply(this,arguments)},this),this},this.init=function(){this.webgisPrefix=this.options.url.webgis,this.shapePrefix=this.options.url.shape,this.epsg5187=new OpenLayers.Projection("EPSG:5187"),this.epsg5186=new OpenLayers.Projection("EPSG:5186"),this.epsg4326=new OpenLayers.Projection("EPSG:4326"),this.epsg900913=new OpenLayers.Projection("EPSG:900913"),this.epsg4019=new OpenLayers.Projection("EPSG:4019"),this.maxBound=new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),this.epsgProj=this["epsg"+this.epsgCode],this.epsgBase=this.epsg900913,this.firstArcize=!0;var styleColor=function(){return"#ff0000"}.bind(this),styleHide=function(e){var t=this.visibleZoomLevel;return"undefined"!=typeof e.layer&&null!=e.layer&&"undefined"!=typeof this.STYLE[e.layer.name]["default"].visibleZoomLevel&&-1!==this.STYLE[e.layer.name]["default"].visibleZoomLevel&&(t=this.STYLE[e.layer.name]["default"].visibleZoomLevel),this.map.getZoom()<t?"none":""}.bind(this),styleSize=function(){return Math.max(this.map.getZoom()-10,3)}.bind(this);this.styleContext={"default":{label:function(){return""},color:styleColor,hide:styleHide,size:styleSize,icon:function(e){return e.geometry instanceof OpenLayers.Geometry.Point?this.webgisPrefix+"images/"+e.layer.layerCode+".gif":null}.bind(this)},select:{color:styleColor,hide:styleHide,size:styleSize}};var styleBase={"default":{display:"${hide}",graphicZIndex:1},select:{graphicZIndex:2},temporary:{graphicZIndex:2}};for(var s in this.STYLE)citus.extend(this.STYLE[s],styleBase);var styleSketch=new OpenLayers.Style;styleSketch.addRules([new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:.3}}})]);var styleSketchMap=new OpenLayers.StyleMap({"default":styleSketch}),measureHandlerOptions={persist:!0,handlerOptions:{layerOptions:{renderers:OpenLayers.Layer.Vector.prototype.renderers,styleMap:styleSketchMap}}},zoomInBoxControl=new OpenLayers.Control.ZoomBox({out:!1,zoomOnClick:!0}),zoomOutBoxControl=new OpenLayers.Control.ZoomBox({out:!0,zoomOnClick:!0}),zoomBoxFunc=function(e){if(e instanceof OpenLayers.Bounds){var t,i=e.getCenterPixel();if(this.out){var r=e.right-e.left,a=e.bottom-e.top,s=Math.min(this.map.size.h/a,this.map.size.w/r),o=this.map.getExtent(),n=this.map.getLonLatFromPixel(i),l=n.lon-o.getWidth()/2*s,h=n.lon+o.getWidth()/2*s,p=n.lat-o.getHeight()/2*s,u=n.lat+o.getHeight()/2*s;t=new OpenLayers.Bounds(l,p,h,u)}else{var d=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),c=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(d.lon,d.lat,c.lon,c.lat)}var f=this.map.getZoom(),y=this.map.getSize(),g={x:y.w/2,y:y.h/2},m=this.map.getZoomForExtent(t),S=this.map.getResolution(),L=this.map.getResolutionForZoom(m);if(S==L)this.map.setCenter(this.map.getLonLatFromPixel(i));else{var v={x:(S*i.x-L*g.x)/(S-L),y:(S*i.y-L*g.y)/(S-L)};this.map.zoomTo(Math.round(m),v)}f==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(f+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))};zoomInBoxControl.zoomBox=zoomOutBoxControl.zoomBox=zoomBoxFunc,OpenLayers.Control.Transection=OpenLayers.Class(OpenLayers.Control.DrawFeature,{title:"Transection",initialize:function(e,t){OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[e,OpenLayers.Handler.Path,t]),this.events.register("activate",this,this.test)},test:function(){},drawFeature:function(geometry){var cut=new OpenLayers.Feature.Vector(geometry),proceed=this.layer.events.triggerEvent("sketchcomplete",{feature:cut});if(this.deactivate(),proceed!==!1){var selected=this.map.webgis.findIntersectedFeatures(this.layer.features,cut),cutNodes=cut.geometry.getVertices(!0);OpenLayers.Request.POST({url:this.map.webgis.shapePrefix+"FindIntersectionsGeometry.json.do",data:OpenLayers.Util.getParameterString({cut:(new OpenLayers.Format.GeoJSON).write(cut),geo:(new OpenLayers.Format.GeoJSON).write(selected)}),headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:function(response){if(200==response.status){var result=eval("("+response.responseText+")");result.start={x:cutNodes[0].x,y:cutNodes[0].y},result.end={x:cutNodes[1].x,y:cutNodes[1].y},citus.task(function(){this.result_callback.apply(this,[{message:"success",features:result}])},this)}else citus.task(function(){this.result_callback.apply(this,[{message:"fail"}])},this)},scope:this})}else citus.task(function(){this.result_callback.apply(this,[{message:"fail"}])},this)},CLASS_NAME:"OpenLayers.Control.Transection"}),OpenLayers.Control.CitusNavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.Navigation,zoomInBoxControl,zoomOutBoxControl,new OpenLayers.Control.Measure(OpenLayers.Handler.Path,measureHandlerOptions),new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,measureHandlerOptions)]),this.defaultControl=this.controls[0]},draw:function(){var e=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return e},deactivateControls:function(){for(var e=this.controls.length,t=0;e>t;t++)this.controls[t].deactivate();this.highlightCtrl&&(this.highlightCtrl.unselectAll(),this.highlightCtrl.deactivate()),this.selectCtrl&&(this.selectCtrl.unselectAll(),this.selectCtrl.deactivate())},activateDefaultControl:function(){null!==this.defaultControl?this.defaultControl.activate():null},activateSelectionControl:function(){this.highlightCtrl?this.highlightCtrl.activate():null,this.selectCtrl?this.selectCtrl.activate():null}}),this.navToolbar=new OpenLayers.Control.CitusNavToolbar(null!=this.options.toolbar.element?{div:OpenLayers.Util.getElement(this.options.toolbar.element)}:{});var measureHandler=function(e){1==e.order?this.options.measures.dist.apply(this,[e.measure,e.units]):this.options.measures.area.apply(this,[e.measure,e.units])}.bind(this);this.navToolbar.controls[3].events.on({measure:measureHandler}),this.navToolbar.controls[4].events.on({measure:measureHandler}),this.mapOptions="localmap"===this.options.basemap.source?{projection:this.epsgBase,numZoomLevels:this.maxZoomLevel+1,webgis:this}:{projection:this.epsgBase,fractionalZoom:!0,webgis:this},this.map=new OpenLayers.Map(element,this.mapOptions);var osmOptions={isBaseLayer:!1,visibility:!1,resolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.25,.1,.05],serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135],transitionEffect:"resize"},osm=new OpenLayers.Layer.OSM("OSM",null,osmOptions);osm.attribution="";var vwOptions={serviceVersion:"",layername:"",isBaseLayer:!1,visibility:!1,opacity:1,type:"png",transitionEffect:"resize",tileSize:new OpenLayers.Size(256,256),min_level:7,max_level:18,buffer:0},vwBase=new vworld.Layers.Base("VBASE",vwOptions),markers=new OpenLayers.Layer.Markers("MARKERS");this.geoserverOptions={isBaseLayer:!1,visibility:!1,numZoomLevels:this.maxZoomLevel+1,resolutions:[305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.25,.1,.05,.025],maxResolution:305.74811309814453,minResolution:.025,maxExtent:this.maxBound},this.geoserver=new OpenLayers.Layer.WMS("geoserver",this.options.basemap.url+"/CITUS/wms",{LAYERS:this.options.basemap.layer,STYLES:"",format:"image/png",tiled:"true"},this.geoserverOptions),"localmap"===this.options.basemap.source?(this.geoserver.setIsBaseLayer(!0),this.map.addLayers([this.geoserver,markers]),this.map.setBaseLayer(this.geoserver),this.map.baseLayer.setVisibility(!0)):(vwBase.setIsBaseLayer(!0),this.map.addLayers([vwBase,markers]),this.map.setBaseLayer(vwBase),this.map.baseLayer.setVisibility(!0)),OpenLayers.Control.Navigation.prototype.counter=0,OpenLayers.Control.Navigation.prototype.wheelUp=function(e){this.counter++,this.counter>2&&(this.counter=0,this.wheelChange(e,1))},OpenLayers.Control.Navigation.prototype.wheelDown=function(e){this.counter--,this.counter<-2&&(this.counter=0,this.wheelChange(e,-1))};var overviewOptions={size:{w:300,h:200},maximized:!1,minRatio:1,maxRatio:this.geoserverOptions.maxResolution/this.geoserverOptions.minResolution,mapOptions:{restrictedExtent:new OpenLayers.Bounds(this.minx,this.miny,this.maxx,this.maxy).transform(this.epsg4326,this.epsgBase),numZoomLevels:1,autoPan:!0}};this.overview=new OpenLayers.Control.OverviewMap(overviewOptions),this.map.addControl(this.overview),this.map.addControls([this.navToolbar,new OpenLayers.Control.LayerSwitcher,this.history=new OpenLayers.Control.NavigationHistory,new OpenLayers.Control.Navigation({mouseWheelOptions:{cumulative:!1,interval:100,maxDelta:1}}),new OpenLayers.Control.Attribution,new OpenLayers.Control.ScaleLine({bottomOutUnits:"",bottomInUnits:"",maxWidth:200}),new OpenLayers.Control.KeyboardDefaults,new OpenLayers.Control.MousePosition({prefix:"EPSG:"+this.epsgCode+" 좌표: ",separator:" | ",numDigits:2,emptyString:"",displayProjection:this.epsgProj})]);var mapEventHandler=function(){var e=$("#scale");if(null!=e&&this.displayScale(e),null==this.editor)for(var t=this.map.getExtent().transform(this.epsgBase,this.epsgProj),i=this.map.getLayersBy("visibility",!0),r=this.map.getZoom(),a=0,s=i.length;s>a;a++){var o=this.visibleZoomLevel;"OSM"!==i[a].name&&"VBASE"!==i[a].name&&"MARKERS"!==i[a].name&&"geoserver"!==i[a].name&&("undefined"!=typeof this.STYLE[i[a].name]["default"].visibleZoomLevel&&-1!==this.STYLE[i[a].name]["default"].visibleZoomLevel&&(o=this.STYLE[i[a].name]["default"].visibleZoomLevel),r>=o&&(null!=i[a].request,i[a].request=OpenLayers.Request.POST(this.buildFeaturesInExtentRequest(i[a],t))))}null!=this.editorToolbar&&this.editorToolbar.controls[1].snapping.active&&citus.task(function(){this.setSnaping(this.editor.opts.snaping.layerName,this.editor.opts.snaping.tolerance)},this)};return this.map.events.register("moveend",this,mapEventHandler),this.map.events.register("updatesize",this,mapEventHandler),this.map.setCenter(new OpenLayers.LonLat(this.lon,this.lat).transform(this.epsg4326,this.epsgBase),this.initialZoom),this},this.buildFeaturesInExtentRequest=function(e,t,i){var r=this.splitLayerName(e.name);return{url:this.shapePrefix+"areaQuery.json.do",data:OpenLayers.Util.getParameterString({table:r.name,code:r.code,MINX:Math.floor(t.left),MINY:Math.floor(t.bottom),MAXX:Math.ceil(t.right),MAXY:Math.ceil(t.top)}),scope:this,headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},callback:function(t){var r=200==t.status?function(t){return e.destroyFeatures(),t.responseText&&e.addFeatures(new OpenLayers.Format.GeoJSON({internalProjection:this.map.getProjection(),externalProjection:this.epsgProj}).read(t.responseText)),e.request=null,"success"}.bind(this)(t):"fail";if("undefined"!=typeof i&&i.apply(this,[{message:r}]),e.pendingHighlight){var a=e.pendingHighlight.feature;this.selectFeatureByAttribute(a,e.pendingHighlight.callback),e.pendingHighlight=null}}}},this.splitLayerName=function(e){var t=e.split(".",2);return{name:t[0],code:t[1]}},this.joinLayerName=function(e,t){return e+"."+t},this.addLayer=function(e,t,i){if(this.editor)return this;"undefined"==typeof i&&(i=this.styleContext);var r=new OpenLayers.Layer.Vector(e,{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(this.STYLE[e]?this.STYLE[e]["default"]:{},{context:i["default"]}),select:new OpenLayers.Style(this.STYLE[e]?this.STYLE[e].select:{},{context:i.select})})});return r.layerCode=e.slice(".",1),r.request=null,this.map.addLayer(r),r.setVisibility(!0),citus.task(function(){this.map.events.triggerEvent("moveend")}.bind(this)),this},this.removeLayer=function(e){if(this.editor)return this;var t=this.map.getLayersByName(e)[0];return t.request&&(t.request.abort(),t.request=null),this.map.removeLayer(t),this},this.baseLayer=function(){return"VBASE"==this.map.baseLayer.name?"vworldmap":"localmap"},this.activeLayer=function(e){var t=this.map.getLayersBy("visibility",!0);if(0==t.length)throw{message:"no layer added to the map"};for(var i=null,r=0,a=t.length;a>r;r++)t[r].isBaseLayer===!1&&(i=t[r]);if("undefined"==typeof e)return i.name;this.editor&&(this.cancelAdding(function(){return!1},function(){}),wfmsMap.tool_toggle(),wfmsMap.map_tool_pan());var s=this.map.getLayersByName(e)[0];return this.map.removeLayer(s),this.map.addLayer(s),null!==this.navToolbar.highlightCtrl&&this.map.removeControl(this.navToolbar.highlightCtrl),null!==this.navToolbar.selectCtrl&&this.map.removeControl(this.navToolbar.selectCtrl),this.navToolbar.highlightCtrl=new OpenLayers.Control.SelectFeature(s,{multiple:!1,hover:!0,toggleKey:"ctrlKey",multipleKey:"shiftKey",highlightOnly:!0,renderIntent:"temporary"}),this.navToolbar.selectCtrl=new OpenLayers.Control.SelectFeature(s,{clickout:!0,toggle:!1,toggleKey:"ctrlKey",multipleKey:"shiftKey",box:!0,onSelect:function(){null!=this.options.handlers.onSelect?this.options.handlers.onSelect.apply(this,arguments):null}.bind(this),onUnselect:function(){null!==this.options.handlers.onUnselect?this.options.handlers.onUnselect.apply(this,arguments):null}.bind(this)}),this.map.addControl(this.navToolbar.highlightCtrl),this.map.addControl(this.navToolbar.selectCtrl),this},this.switchBaseLayer=function(e){var t="";switch(parseInt(e,10)){case 0:t="geoserver";break;case 1:t="VBASE"}this.map.baseLayer.setVisibility(!1),this.map.setBaseLayer(this.map.getLayersByName(t)[0]),this.map.baseLayer.setVisibility(!0)},this.getScale=function(){return this.map.getScale()},this.displayScale=function(e){var t=parseInt(this.getScale(),10);t=t.toLocaleString(),e.val(t)},this.setScale=function(e){return isNaN(e)?!1:this.map.zoomToScale(e,!0)},this.redraw=function(){for(var e=this.map.getLayersBy("visibility",!0),t=0,i=e.length;i>t;t++)e[t].redraw();return this},this.setSelectionMode=function(){return this.navToolbar.deactivateControls(),this.navToolbar.activateSelectionControl(),this},this.setNavPanMode=function(){return this.navToolbar.deactivateControls(),this.navToolbar.activateControl(this.navToolbar.controls[0]),this},this.setNavZoomInMode=function(){return this.navToolbar.deactivateControls(),this.navToolbar.activateControl(this.navToolbar.controls[1]),this},this.setNavZoomOutMode=function(){return this.navToolbar.deactivateControls(),this.navToolbar.activateControl(this.navToolbar.controls[2]),this},this.transectionMode=function(e){var t=this.map.getLayersByName(this.activeLayer())[0];return this.navToolbar.deactivateControls(),this.map.addControl(new OpenLayers.Control.Transection(t,{titile:"Transection",autoActivate:!0,result_callback:e})),this},this.hideLayer=function(e){if(this.editor)return this;this.setNavPanMode();var t=this.map.getLayersByName(e);return t.length>0?t[0].setVisibility(!1):null,this},this.showLayer=function(e,t){if(this.editor)return this;this.setNavPanMode();var i=this.map.getLayersByName(e);return i.length>0?i[0].setVisibility(!0):this.addLayer(e,t),"undefined"!=typeof t&&citus.task(function(){t.apply(this,arguments)},this),this},this.featureByZoomLevel=function(e,t){return"undefined"==typeof t?"undefined"==typeof this.STYLE[e]["default"].visibleZoomLevel?-1:this.STYLE[e]["default"].visibleZoomLevel:(this.STYLE[e]["default"].visibleZoomLevel=t,this.map.events.triggerEvent("moveend"),t)},this.setLabel=function(e,t,i,r){this.STYLE[e]["default"].label="${"+(null==t?"label":t)+"}";var a=15,s=0;"undefined"!=typeof i&&(s=i),"undefined"!=typeof r&&(a=-r),this.STYLE[e]["default"].labelXOffset=s,this.STYLE[e]["default"].labelYOffset=a,this.map.events.triggerEvent("moveend")},this.showFullMap=function(){return this.setNavPanMode(),"localmap"===this.options.basemap?this.center(330374.24,510509.96,this.initialZoom,"5186"):this.map.setCenter(new OpenLayers.LonLat(this.lon,this.lat).transform(this.epsg4326,this.epsgBase),this.initialZoom),this},this.center=function(e,t,i,r){if("undefined"==typeof e){var a=this.map.getCenter().transform(this.epsgBase,this.epsg4326);return{lon:a.lon,lat:a.lat,epsg:"4326",zoom:this.map.getZoom()}}return this.setNavPanMode(),this.map.setCenter(new OpenLayers.LonLat(e,t).transform(this["epsg"+("undefined"==typeof r?"4326":r)],this.epsgBase),i),this},this.zoomTo=function(e){"undefined"!=typeof e&&"undefined"!=typeof e.layer&&(e.layer.pendingHighlight={feature:e,layer:e.layer,callback:function(){}},e.geometry.calculateBounds(),this.map.zoomToExtent(e.geometry.bounds.clone().transform(this.epsgProj,this.epsgBase)))},this.setMarker=function(e,t,i,r){var a=this.map.getLayersByName("MARKERS"),s=a.length>0?a[0]:new OpenLayers.Layer.Markers("MARKERS");return s.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(e,t).transform(this["epsg"+(r||"4326")],this.epsgBase),new OpenLayers.Icon(this.webgisPrefix+"images/marker.png",new OpenLayers.Size(21,32),new OpenLayers.Pixel(-11,-32)))),this.center(e,t,i,r)},this.resetMarkers=function(){var e=this.map.getLayersByName("MARKERS")[0];return e.clearMarkers(),this},this.measureDist=function(e){return this.navToolbar.deactivateControls(),"undefined"==typeof e?e=this.options.measures.dist:this.options.measures.dist=e,this.navToolbar.activateControl(this.navToolbar.controls[3]),this},this.measureArea=function(e){return this.navToolbar.deactivateControls(),"undefined"==typeof e?e=this.options.measures.area:this.options.measures.area=e,this.navToolbar.activateControl(this.navToolbar.controls[4]),this},this.movePrevPosition=function(){return this.setNavPanMode(),this.history.previousTrigger(),this},this.moveNextPosition=function(){return this.setNavPanMode(),this.history.nextTrigger(),this},this.buildFindFeatureRequest=function(e,t){var i=this.splitLayerName(e.layer);return{url:this.shapePrefix+"FindFeature.json.do",data:OpenLayers.Util.getParameterString({table:i.name,code:i.code,index:e.index}),scope:this,headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},callback:function(i){var r=this.map.getLayersByName(e.layer)[0],a=200==i.status?function(e){if(e.responseText){var t=(new OpenLayers.Format.GeoJSON).read(e.responseText)[0];return"undefined"==typeof t?{message:"fail"}:(t.layer=r,t.centroid=t.geometry.getCentroid(),{message:"success",feature:t})}return{message:"fail"}}.bind(this)(i):{message:"fail"};"undefined"!=typeof r&&(r.requestFindFeature=null),"undefined"!=typeof t&&t.apply(this,[a])}}},this.selectFeatureByAttribute=function(e,t){for(var i=e.layer,r=i.features.length,a=0;r>a;a++){var s=i.features[a];if(s.attributes.FTR_IDN==e.attributes.FTR_IDN&&s.attributes.FTR_CDE==e.attributes.FTR_CDE){this.navToolbar.selectCtrl.unselectAll(),this.navToolbar.selectCtrl.highlight(s),citus.task(function(){t.apply(this,[s])},this);break}}},this.findFeature=function(e,t){return this.editor&&(this.cancelAdding(function(){return!1},function(){}),wfmsMap.tool_toggle(),wfmsMap.map_tool_pan()),e.layer.requestFindFeature=OpenLayers.Request.POST(this.buildFindFeatureRequest(e,t)),this},this.highlightFeature=function(e,t){if(this.editor)citus.task(function(){t.apply(this,[{message:"fail"}])},this);else{var i=e.geometry.getCentroid();e.layer.pendingHighlight={feature:e,layer:e.layer,callback:t},this.center(i.x,i.y,this.visibleZoomLevel,this.epsgCode+"")}return this},this.unhighlightFeature=function(e){return this.editor?citus.task(function(){callback.apply(this,[{message:"fail"}])},this):this.navToolbar.selectCtrl.unhighlight(e),this},this.transformCoordinate=function(e,t,i,r){var a=new OpenLayers.Geometry.Point(e,t),s=OpenLayers.Projection.transform(a,this["epsg"+i],this["epsg"+r]);return{x:s.x,y:s.y}},this.findIntersectedFeatures=function(e,t){for(var i=t.geometry,r=[],a=0;a<e.length;a++)t.id!==e[a].id&&i.intersects(e[a].geometry)&&(r.push(e[a]),e[a].attributes.intersectionX=.1,e[a].attributes.intersectionY=.1,e[a].attributes.distance=.1);return r},this.onFeatureModified=function(e){e.feature&&this.editor&&(this.editor.featuresMod[e.feature.attributes.FTR_IDN]=e.feature)},this.onFeatureAdded=function(e){if(e.feature&&this.editor)if(e.feature.state===OpenLayers.State.UPDATE&&"SPLIT"===e.feature.reason){var t=this.editor.opts.splitingParam;t.callback&&citus.task(function(){t.callback.apply(this,[e.feature,"Mod"])},this),this.editor.featuresMod[e.feature.attributes.FTR_IDN]=e.feature}else if(e.feature.state===OpenLayers.State.INSERT&&"SPLIT"===e.feature.reason){var t=this.editor.opts.splitingParam;t.callback&&citus.task(function(){t.callback.apply(this,[e.feature,"Add"])},this);var i="undefined"!=typeof e.feature.attributes.FTR_IDN?e.feature.attributes.FTR_IDN:-1;e.feature.attributes.FTR_IDN=i,this.editor.featuresAdd[i]=e.feature}else if(e.feature.state===OpenLayers.State.UPDATE&&"MERGE"===e.feature.reason){var r=this.editor.opts.mergingParam;r.callback&&citus.task(function(){r.callback.apply(this,[e.feature,"Mod"])},this),this.editor.featuresMod[e.feature.attributes.FTR_IDN]=e.feature}else if(this.editor.opts.append){var a=this.editor.opts.addingParam;e.feature.attributes=a.featureTemplate,e.feature.data=a.featureTemplate;var s=e.feature.geometry.getCentroid().transform(this.epsgBase,this.epsgProj);if(e.feature.centroid={x:s.x,y:s.y,epsg:this.epsgCode},!this.editor.featuresAdd[e.feature.attributes.FTR_IDN]){var o=this.findIntersectedFeatures(this.editor.targetLayer.features,e.feature);if("path"===this.FEATURE[this.editor.editLayer.name].type&&1===o.length){var n=a.feature=e.feature,l=new OpenLayers.Format.WKT,h=l.write(o[0]),p=l.write(n);this.firstArcize?OpenLayers.Request.POST({url:this.shapePrefix+"ArcizeGeometry.json.do",data:OpenLayers.Util.getParameterString({cut:p,geo:h,radius:a.options.overlapRadius}),headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:this.arcizeCallback,scope:this}):this.firstArcize=!0}else this.editor.featuresAdd[e.feature.attributes.FTR_IDN]=e.feature,citus.task(function(){this.endEditingInternal.apply(this,["Add",function(){return!0}.bind(this),a.callback.bind(this),a.options.onStart.bind(this)])},this)}}},this.toFeatures=function(e){if(null===e||"object"!=typeof e)throw new Error("Parameter does not match expected type.");
var t=[];e instanceof Array||(e=[e]);for(var i=0,r=e.length;r>i;i++)if("OpenLayers.Geometry.MultiPolygon"===e[i].geometry.CLASS_NAME||"OpenLayers.Geometry.Collection"===e[i].geometry.CLASS_NAME)for(var a=0,s=e[i].geometry.components.length;s>a;a++)t.push(new OpenLayers.Feature.Vector(e[i].geometry.components[a]));else"OpenLayers.Geometry.Polygon"===e[i].geometry.CLASS_NAME&&t.push(new OpenLayers.Feature.Vector(e[i].geometry));return t},this.arcizeCallback=function(e){if(200==e.status){this.firstArcize=!1;var t=new OpenLayers.Format.GeoJSON,i=t.read(e.responseText),r=this.toFeatures(i)[0];if(null!==this.editor&&this.editor.opts.addingParam&&this.editor.opts.addingParam.feature){var a=this.editor.opts.addingParam,s=a.feature;r.data=s.data,r.attributes=s.attributes,r.centroid=s.centroid,this.editor.targetLayer.removeFeatures(s),this.editor.targetLayer.addFeatures(r),this.editor.featuresAdd[r.attributes.FTR_IDN]=r,citus.task(function(){this.endEditingInternal.apply(this,["Add",function(){return!0}.bind(this),a.callback.bind(this),a.options.onStart.bind(this)])},this)}else citus.task(function(){this.endEditingInternal.apply(this,["Add",function(){return!1}.bind(this)])},this)}else alert("상하월 작성중 에러가 발생했습니다."),this.cancelAdding(function(e,t){return"Add"==t?!1:void 0},function(){})},this.onFeatureDeleted=function(e){e.feature&&this.editor&&(this.editor.featuresDel[e.feature.attributes.FTR_IDN]=e.feature)},this.onFeaturesRemoved=function(e){if(e.features&&this.editor)for(var t=0;t<e.features.length;t++){var i=e.features[t];i.state===OpenLayers.State.DELETE&&"MERGE"===i.reason?("undefined"!=typeof this.editor.featuresMod[e.features[t].attributes.FTR_IDN]&&delete this.editor.featuresMod[e.features[t].attributes.FTR_IDN],this.editor.featuresDel[e.features[t].attributes.FTR_IDN]=e.features[t]):i.state===OpenLayers.State.DELETE&&"SPLIT"===i.reason||(this.editor.featuresDel[e.features[t].attributes.FTR_IDN]=e.features[t])}},this.startEditing=function(e,t){this.resetMarkers(),this.navToolbar.deactivateControls(),this.map.removeControl(this.navToolbar);var i=this.map.getLayersByName(e)[0],r=i;if("undefined"!=typeof this.FEATURE[e]){var a=this.FEATURE[e].type,s={append:!1,addingParam:{options:{overlapRadius:1},featureTemplate:null,callback:null},mergingParam:{callback:null},splitingParam:{callback:null},snaping:{layerName:"",tolerance:10}};OpenLayers.Util.extend(s.snaping,this.options.snaping),OpenLayers.Util.extend(s,t),null===this.editor&&(this.editor=new OpenLayers.Editor(this.map,{activeControls:["CADTools","SnappingSettings","ImportFeature","MergeFeature","SplitFeature","DeleteAllFeatures","DrawHole","Navigation","TransformFeature","CleanFeature","DeleteFeature","DragFeature","SelectFeature","ModifyFeature"],featureTypes:[a],targetLayer:i,editLayer:r,undoRedoActive:!0,oleSplitUrl:this.options.url.shape+"SplitGeometry.json.do",oleMergeUrl:this.options.url.shape+"MergeGeometry.json.do",tableName:e.slice(".",0),styleMap:r.styleMap,requestSplitComplete:function(e){var t=JSON.parse(e.responseText);"undefined"!=typeof t.error&&alert(t.error);var i=this.geoJSON.read(e.responseText),r=this.editLayer.selectedFeatures[0],a=this.toFeatures(i);if(a.length>=2){OpenLayers.Util.extend(a[0].attributes,r.attributes),a[0].data=a[0].attributes,r.state=OpenLayers.State.DELETE,r.reason="SPLIT",a[0].state=OpenLayers.State.UPDATE,a[0].reason="SPLIT";for(var s=1;s<a.length;s++)OpenLayers.Util.extend(a[s].attributes,r.attributes),a[s].data=a[s].attributes,a[s].state=OpenLayers.State.INSERT,a[s].reason="SPLIT";this.editLayer.removeFeatures(r),this.editLayer.addFeatures(a),this.editLayer.events.triggerEvent("featureselected")}},requestMergeComplete:function(e){var t=JSON.parse(e.responseText);"undefined"!=typeof t.error&&alert(t.error);var i=this.geoJSON.read(e.responseText),r=this.editLayer.selectedFeatures,a=this.toFeatures(i);if(r.length>1&&a.length>0){for(var s=0;s<r.length;s++)r[s].state=OpenLayers.State.DELETE,r[s].reason="MERGE";OpenLayers.Util.extend(a[0].attributes,r[0].attributes),a[0].data=a[0].attributes,a[0].state=OpenLayers.State.UPDATE,a[0].reason="MERGE",this.editLayer.removeFeatures(r),this.editLayer.addFeatures([a[0]]),this.editLayer.events.triggerEvent("featureselected")}}})),this.editor.opts=s,this.editorToolbar={},this.editorToolbar.controls=this.editor.editorPanel.controls,this.editorToolbar.deactivateControls=function(){for(var e=this.editorToolbar.controls.length,t=0;e>t;t++)this.editorToolbar.controls[t].deactivate()}.bind(this),this.editor.featuresMod={},this.editor.featuresDel={},this.editor.featuresAdd={},r.events.listeners.hasOwnProperty("featureadded")||r.events.register("featureadded",this,this.onFeatureAdded),r.events.listeners.hasOwnProperty("afterfeaturemodified")||r.events.register("afterfeaturemodified",this,this.onFeatureModified),r.events.listeners.hasOwnProperty("featuredeleted")||r.events.register("featuredeleted",this,this.onFeatureDeleted),r.events.listeners.hasOwnProperty("featuresremoved")||r.events.register("featuresremoved",this,this.onFeaturesRemoved),this.editorToolbar.controls[11].events.listeners.hasOwnProperty("dragcomplete")||this.editorToolbar.controls[11].events.register("dragcomplete",this,this.onFeatureModified),this.editorToolbar.controls[13].layer.events.listeners.hasOwnProperty("vertexmodified")||this.editorToolbar.controls[13].layer.events.register("vertexmodified",this,this.onFeatureModified);var o=function(e){null!=e&&e.abort()};return o(r.updateMod),r.updateMod=null,o(r.updateAdd),r.updateAdd=null,o(r.updateDel),r.updateDel=null,citus.task(function(){this.setSnaping(this.editor.opts.snaping.layerName,this.editor.opts.snaping.tolerance)},this),this.editor.startEditMode(),this.controlUndoRedo().register(),this}},this.updateGeometry=function(e,t,i,r,a){var s=(new OpenLayers.Format.GeoJSON).write(i);return{url:this.shapePrefix+t+"Geometry.json.do",data:OpenLayers.Util.getParameterString({tableName:e.name.slice(".",0),featureCollection:s}),scope:this,headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},callback:function(s){var o=200==s.status?function(){return"success"}.bind(this)(s):"fail";"undefined"!=typeof r&&citus.task(function(){r.apply(this,[{message:o,features:i}])},this),e["update"+t]=null,"undefined"!=typeof a&&citus.task(function(){a.apply(this,arguments)}.bind(this))}}},this.updateRequest=function(e,t,i,r){if(e.length>0){t["update"+i]&&t["update"+i].abort();for(var a=0;a<e.length;a++)e[a].geometry.transform(this.epsgBase,this.epsgProj);if("undefined"==typeof e[0].reason||"SPLIT"!=e[0].reason&&"MERGE"!=e[0].reason)t["update"+i]=OpenLayers.Request.POST(this.updateGeometry.apply(this,[t,i,e,r,function(){this.map.events.triggerEvent("moveend")}]));else for(var a=0;a<e.length;a++){var s=e[a],o=[];o.push(s);var n;n="Insert"==s.state?"Add":"Delete"==s.state?"Del":i;var l,h;a==e.length-1?(l=r,h=function(){this.map.events.triggerEvent("moveend")}):(l=void 0,h=void 0),t["update"+n]=OpenLayers.Request.POST(this.updateGeometry.apply(this,[t,n,o,l,h]))}}else t["update"+i]=OpenLayers.Request.POST(this.updateGeometry.apply(this,[t,i,e,r,function(){this.map.events.triggerEvent("moveend")}]))},this.getherFeaturesByMode=function(e){var t=[];for(var i in this.editor["features"+e])"Del"==e?"undefined"==typeof this.editor.featuresMod[i]&&t.push(this.editor["features"+e][i]):t.push(this.editor["features"+e][i]);return t},this.cancelAdding=function(e,t){return this.endEditingInternal("Add",e,t)},this.endEditing=function(e,t){return this.endEditingInternal("Mod",e,t)},this.endEditingInternal=function(e,t,i,r){if(null!=this.editor){this.controlUndoRedo().reset(),this.editor.stopEditMode();var a=this.editor.editLayer;a.events.listeners.hasOwnProperty("featureadded")&&(a.events.unregister("featureadded",this,this.onFeatureAdded),delete a.events.listeners.featureadded),a.events.listeners.hasOwnProperty("afterfeaturemodified")&&(a.events.unregister("afterfeaturemodified",this,this.onFeatureModified),delete a.events.listeners.afterfeaturemodified),a.events.listeners.hasOwnProperty("featuredeleted")&&(a.events.unregister("featuredeleted",this,this.onFeatureDeleted),delete a.events.listeners.featuredeleted),a.events.listeners.hasOwnProperty("featuresremoved")&&(a.events.unregister("featuresremoved",this,this.onFeaturesRemoved),delete a.events.listeners.featuresremoved),this.editorToolbar.controls[11].events.listeners.hasOwnProperty("dragcomplete")&&(this.editorToolbar.controls[11].events.unregister("dragcomplete",this,this.onFeatureModified),delete this.editorToolbar.controls[11].events.listeners.dragcomplete),this.editorToolbar.controls[13].layer.events.listeners.hasOwnProperty("vertexmodified")&&(this.editorToolbar.controls[13].layer.events.unregister("vertexmodified",this,this.onFeatureModified),delete this.editorToolbar.controls[13].layer.events.listeners.vertexmodified);var s,o,n;return"Mod"===e&&(Object.keys(this.editor.featuresDel).length>0&&(o=this.getherFeaturesByMode("Del")),Object.keys(this.editor.featuresAdd).length>0&&(n=this.getherFeaturesByMode("Add"))),s=this.getherFeaturesByMode(e),"undefined"!=typeof o&&(s=s.concat(o)),"undefined"!=typeof n&&(s=s.concat(n)),t.apply(this,[s,e])===!0?("undefined"!=typeof r&&r.apply(this),this.updateRequest.apply(this,[s,a,e,i])):(citus.task(function(){this.map.events.triggerEvent("moveend")},this),console&&console.log("the user cancels to update features.")),delete this.editorToolbar,delete this.editor,this.editorToolbar=null,this.editor=null,this.map.addControl(this.navToolbar),this.navToolbar.activateDefaultControl(),this.resetSnaping(),this}},this.addGeometryToDB=function(e,t,i){var r=this.map.getLayersByName(e)[0];this.updateRequest.apply(this,[t,r,"Add",i])},this.delGeometryToDB=function(e,t,i){var r=this.map.getLayersByName(e)[0];this.updateRequest.apply(this,[t,r,"Del",i])},this.addInterest=function(e,t,i){var r=this.map.getExtent().transform(this.epsgBase,this.epsgProj);return OpenLayers.Request.POST({url:this.shapePrefix+"AddInterest.json.do",data:OpenLayers.Util.getParameterString({userId:t,interstName:e,minx:r.left,miny:r.bottom,maxx:r.right,maxy:r.top}),headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:i,scope:this}),this},this.delInterest=function(e,t,i){return OpenLayers.Request.POST({url:this.shapePrefix+"DelInterest.json.do",data:OpenLayers.Util.getParameterString({userId:t,intIdn:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:i,scope:this}),this},this.listInterest=function(e,t){return OpenLayers.Request.POST({url:this.shapePrefix+"ListInterest.json.do",data:OpenLayers.Util.getParameterString({userId:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:t,scope:this}),this},this.showInterest=function(e,t,i,r){var a=new OpenLayers.Bounds(e,t,i,r);return this.map.zoomToExtent(a.transform(this.epsgProj,this.epsgBase)),this},this.addFeature=function(e,t,i,r){return this.editor?(citus.task(function(){i.apply(this,[{message:"not allowed in editing mode"}])},this),this):("undefined"==typeof r?r={onStart:function(){}}:"undefined"==typeof r.onStart&&(r.onStart=function(){}),this.startEditing(e,{append:!0,addingParam:{options:r,featureTemplate:t,callback:i}}),this.editorToolbar.deactivateControls(),this.editorToolbar.controls[14].activate(),this)},this.modifyFeature=function(e){this.editorToolbar.deactivateControls();var t="point"===this.editor.featureTypes[0]?11:13;return this.editorToolbar.controls[t].activate(),"undefined"!=typeof e&&citus.task(function(){e.apply(this,arguments)},this),this},this.selectFeature=function(){return null!==this.editorToolbar&&(this.editorToolbar.deactivateControls(),this.editorToolbar.controls[12].activate()),this},this.dragFeature=function(){return this.editorToolbar.deactivateControls(),this.editorToolbar.controls[11].activate(),this},this.moveFeature=function(e,t,i){args=[0,0];var r=this.editor.editLayer.selectedFeatures.length;if(r>0)for(var a=0;r>a;a++){var s=this.editor.editLayer.selectedFeatures[a];s.geometry.move(e,t),s.layer.drawFeature(s)}return"undefined"!=typeof i&&citus.task(function(){i.apply(this,args)},this),this},this.deleteFeature=function(e,t,i){if(this.editor)return citus.task(function(){i.apply(this,[{message:"not allowed in editing mode"}])},this),this;var r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0),t),a=this.map.getLayersByName(e)[0];return this.updateRequest.apply(this,[[r],a,"Del",i]),this},this.selectedFeatures=function(){return this.editor.editLayer.selectedFeatures},this.addModified=function(e){return this.editor.featuresMod[e.attributes.FTR_IDN]=e,this},this.cleanFeature=function(){return this.editorToolbar.deactivateControls(),this.editorToolbar.controls[9].activate(),this},this.transformFeature=function(){return this.editorToolbar.deactivateControls(),this.editorToolbar.controls[8].activate(),this},this.navigationMode=function(){return this.editorToolbar.deactivateControls(),this.editorToolbar.controls[7].activate(),this},this.mergeFeatures=function(e){return null!==this.editorToolbar&&(this.editorToolbar.deactivateControls(),this.editorToolbar.controls[3].activate(),this.editor.opts.mergingParam.callback=e),this},this.splitFeature=function(e){return null!==this.editorToolbar&&(this.editorToolbar.deactivateControls(),this.editorToolbar.controls[4].activate(),this.editor.opts.splitingParam.callback=e),this},this.setSnaping=function(e,t){var i=this.map.getLayersByName(e)[0],r=parseInt(this.editorToolbar.controls[1].snapping.getGeoTolerance(t,1/this.map.resolution),10);return this.editorToolbar.controls[1].snappingLayers=[i],this.editorToolbar.controls[1].toleranceInput={value:r},this.editorToolbar.controls[1].changeSnapping(),this},this.resetSnaping=function(){return null!=this.editorToolbar&&this.editorToolbar.controls[1].snapping.deactivate(),this},this.settingSnap=function(e,t){return"undefined"==typeof e?this.options.snaping:(this.options.snaping={layerName:e,tolerance:t},this)},this.panEditor=function(){return this},this.controlUndoRedo=function(){var e=this.map.getControlsByClass("OpenLayers.Editor.Control.UndoRedo");return e[e.length-1]},this.undo=function(){var e=this.controlUndoRedo();e&&e.undo()},this.redo=function(){var e=this.controlUndoRedo();e&&e.redo()},this.searchPoi=function(){if(null!=$("#q")&&$("#q").val().length>=2){$("#search_result").empty();var e={f:"json",pretty:"true",q:$("#q").val(),category:$("#category").val(),pageUnit:100,pageIndex:1,output:"json",apiKey:"4FAC4DA4-D9B1-3CE5-891C-CE3664473E79"},t=new OpenLayers.Protocol.Script;t.createRequest("http://map.vworld.kr/search.do",e,this.searchPoiResult)}else alert("검색어를 2자 이상 입력해 주세요.")},this.clearPoi=function(){null!=$("#q")&&$("#q").val(""),null!=$("#search_result")&&($("#search_result").empty(),$("#search_result").css("height","0px")),webgis.resetMarkers()},this.searchPoiResult=function(e){if(null!=$("#search_result")){$("#search_result").css("height","200px");for(var t=0;t<e.LIST.length;t++)$("#search_result").append("Poi"==e.category?'<p><a href="#" class="olSearchResult" id="result_'+t+'" x="'+e.LIST[t].xpos+'" y="'+e.LIST[t].ypos+'">'+e.LIST[t].nameFull+"</a>: "+e.LIST[t].njuso+"</p>":"Juso"==e.category?'<p><a href="#" class="olSearchResult" id="result_'+t+'" x="'+e.LIST[t].xpos+'" y="'+e.LIST[t].ypos+'">'+e.LIST[t].JUSO+"</a> ("+e.LIST[t].ZIP_CL+")</p>":"Jibun"==e.category?'<p><a href="#" class="olSearchResult" id="result_'+t+'" x="'+e.LIST[t].xpos+'" y="'+e.LIST[t].ypos+'">'+e.LIST[t].JUSO+"</a></p>":"<p>잘못된 요청입니다.</p>");$(".olSearchResult").click(function(){webgis.setMarker(parseFloat($(this).attr("x")),parseFloat($(this).attr("y")),17,"4019")})}},window.$$WebGIS$$=this};$WebGIS.prototype=$WebGIS_proto,$citus=function(){this.loadJS=function(e,t){var i=document.createElement("script");i.src=e,i.async=!1,i.onreadystatechange=i.onload=function(){var e=i.readyState;t.done||e&&!/loaded|complete/.test(e)||(t.done=!0,t())},document.getElementsByTagName("head")[0].appendChild(i)},this.extend=function(e,t){for(var i in t)try{e[i]=t[i].constructor==Object?this.extend(e[i],t[i]):t[i]}catch(r){e&&(e[i]=t[i])}return e},this.task=function(e,t){"function"==typeof e&&setTimeout(e.bind(t),0)},"undefined"==typeof Array.contain&&(Array.prototype.contain=function(e){return this.indexOf(e)<0?!1:!0}),"undefined"==typeof String.slice&&(String.prototype.slice=function(e,t){return this.split(e)[t]}),this.WebGIS=$WebGIS,this.VERSION_NUMBER="Release 0.96 dev"},window.citus=new $citus}();